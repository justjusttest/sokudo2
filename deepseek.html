<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸“ä¸šæ•°ç‹¬ | å”¯ä¸€è§£è°œé¢˜</title>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <style>
        /* ========== åŸºç¡€æ ·å¼ ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2b3c 0%, #0d1724 100%);
            color: #f8f5e9;
            min-height: 100vh;
            padding: 20px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ========== æ ‡é¢˜æ ·å¼ ========== */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(248, 245, 233, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(74, 124, 89, 0.3);
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #4a7c59;
            margin-bottom: 10px;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            color: #8fb996;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* ========== æ¸¸æˆä¿¡æ¯æ  ========== */
        .game-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 24px;
            background: rgba(248, 245, 233, 0.08);
            border-radius: 10px;
            border: 1px solid rgba(74, 124, 89, 0.2);
        }
        
        .info-item i {
            color: #4a7c59;
            font-size: 1.2rem;
        }
        
        .info-value {
            font-weight: bold;
            font-size: 1.2rem;
            color: #f8f5e9;
        }
        
        /* ========== ä¸»æ¸¸æˆåŒºåŸŸ ========== */
        .game-area {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
            margin-bottom: 40px;
        }
        
        .board-container {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
        }
        
        .board-wrapper {
            background: rgba(248, 245, 233, 0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px solid #4a7c59;
            margin-bottom: 20px;
        }
        
        /* ========== æ•°ç‹¬æ£‹ç›˜ ========== */
        #sudoku-board {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            gap: 0;
            width: 100%;
            aspect-ratio: 1 / 1;
            border: 3px solid #2e5d43;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .cell {
            background: white;
            border: 1px solid #cbd5e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            position: relative;
        }
        
        .cell:hover:not(.fixed) {
            background-color: rgba(74, 124, 89, 0.15);
            transform: scale(1.02);
        }
        
        .cell.selected {
            background-color: #e3f2fd !important;
            box-shadow: 0 0 0 3px rgba(74, 124, 89, 0.5) inset;
            border-color: #4a7c59 !important;
        }
        
        .cell.fixed {
            background-color: #e9f5e9;
            font-weight: 700;
            color: #1a2b3c;
        }
        
        .cell.highlight {
            background-color: rgba(255, 249, 196, 0.8) !important;
        }
        
        .cell.error {
            background-color: rgba(255, 107, 107, 0.2) !important;
            color: #c53030 !important;
            border-color: #ff6b6b !important;
        }
        
        .cell.correct {
            background-color: rgba(81, 207, 102, 0.2) !important;
            color: #22543d !important;
            border-color: #51cf66 !important;
        }
        
        /* ä¹å®«æ ¼ç²—è¾¹æ¡† */
        .cell:nth-child(3n) {
            border-right-width: 3px;
            border-right-color: #4a7c59;
        }
        
        .cell:nth-child(9n) {
            border-right-width: 1px;
        }
        
        .cell:nth-child(n+19):nth-child(-n+27),
        .cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom-width: 3px;
            border-bottom-color: #4a7c59;
        }
        
        /* ========== å¤‡æ³¨æ•°å­—æ ·å¼ ========== */
        .notes-grid {
            position: absolute;
            top: 2px;
            left: 2px;
            right: 2px;
            bottom: 2px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 1px;
            padding: 1px;
        }
        
        .note-number {
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #4a7c59;
        }
        
        /* ========== æ•°å­—é”®ç›˜ ========== */
        .keyboard {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            gap: 8px;
            margin-top: 20px;
        }
        
        .keyboard button {
            aspect-ratio: 1;
            border: none;
            border-radius: 8px;
            background: rgba(74, 124, 89, 0.25);
            color: #1a2b3c;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px;
        }
        
        .keyboard button:hover {
            background: rgba(74, 124, 89, 0.35);
            transform: scale(1.05);
        }
        
        .keyboard button:active {
            transform: scale(0.95);
        }
        
        /* ========== æ§åˆ¶é¢æ¿ ========== */
        .control-panel {
            width: 100%;
            max-width: 350px;
            background: rgba(248, 245, 233, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 2px solid #4a7c59;
        }
        
        .panel-section {
            margin-bottom: 25px;
        }
        
        .panel-title {
            color: #2e5d43;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(74, 124, 89, 0.3);
        }
        
        /* ========== éš¾åº¦é€‰æ‹© ========== */
        .difficulty-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .difficulty-btn {
            padding: 12px 5px;
            border: none;
            border-radius: 8px;
            background: rgba(74, 124, 89, 0.15);
            color: #1a2b3c;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .difficulty-btn:hover {
            background: rgba(74, 124, 89, 0.25);
        }
        
        .difficulty-btn.active {
            background: #4a7c59;
            color: white;
            box-shadow: 0 4px 10px rgba(74, 124, 89, 0.3);
        }
        
        /* ========== åŠŸèƒ½æŒ‰é’® ========== */
        .function-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .function-btn {
            padding: 14px 10px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
        }
        
        .function-btn i {
            font-size: 1.1rem;
        }
        
        .btn-primary {
            background: #4a7c59;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3a6c49;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: rgba(212, 162, 78, 0.9);
            color: #1a2b3c;
        }
        
        .btn-secondary:hover {
            background: rgba(212, 162, 78, 1);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: rgba(255, 107, 107, 0.9);
            color: white;
        }
        
        .btn-danger:hover {
            background: rgba(255, 107, 107, 1);
            transform: translateY(-2px);
        }
        
        .btn-info {
            background: rgba(81, 207, 102, 0.9);
            color: white;
        }
        
        .btn-info:hover {
            background: rgba(81, 207, 102, 1);
            transform: translateY(-2px);
        }
        
        /* ========== çŠ¶æ€ä¿¡æ¯ ========== */
        .status-box {
            background: rgba(26, 43, 60, 0.05);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(74, 124, 89, 0.2);
        }
        
        .status-title {
            color: #2e5d43;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .status-text {
            color: #4a5568;
            font-size: 0.95rem;
            margin-bottom: 5px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 8px;
            background: rgba(74, 124, 89, 0.08);
            border-radius: 6px;
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: #4a7c59;
            font-weight: bold;
        }
        
        .stat-value {
            font-size: 1.1rem;
            color: #2e5d43;
            font-weight: bold;
            margin-top: 5px;
        }
        
        /* ========== å”¯ä¸€è§£æ ‡è¯† ========== */
        .unique-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px;
            background: rgba(81, 207, 102, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(81, 207, 102, 0.3);
            margin-top: 20px;
        }
        
        .unique-badge i {
            color: #51cf66;
            font-size: 1.2rem;
        }
        
        .unique-badge span {
            color: #22543d;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        /* ========== æ¨¡æ€æ¡† ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 43, 60, 0.95);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal.active {
            display: flex;
            opacity: 1;
        }
        
        .modal-content {
            background: #f8f5e9;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            color: #2e5d43;
            font-size: 1.8rem;
            font-weight: bold;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #4a5568;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.2s;
        }
        
        .modal-close:hover {
            color: #ff6b6b;
        }
        
        /* ========== åº†ç¥åŠ¨ç”» ========== */
        @keyframes celebrate {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
            100% { transform: translateY(0) scale(1); }
        }
        
        .celebrate {
            animation: celebrate 0.5s ease 3;
        }
        
        /* ========== åŠ è½½åŠ¨ç”» ========== */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 43, 60, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .loading.active {
            display: flex;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(74, 124, 89, 0.3);
            border-top-color: #4a7c59;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ========== å“åº”å¼è®¾è®¡ ========== */
        @media (max-width: 768px) {
            .game-area {
                flex-direction: column;
                align-items: center;
            }
            
            .control-panel {
                max-width: 100%;
            }
            
            .keyboard button {
                min-height: 45px;
                font-size: 1.3rem;
            }
            
            .function-buttons {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .game-info {
                gap: 15px;
            }
            
            .info-item {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .info-value {
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .board-wrapper {
                padding: 10px;
            }
            
            .cell {
                font-size: 1.2rem;
            }
            
            .note-number {
                font-size: 0.6rem;
            }
            
            .control-panel {
                padding: 20px;
            }
            
            .keyboard {
                gap: 5px;
            }
            
            .keyboard button {
                min-height: 40px;
                font-size: 1.1rem;
            }
        }
        
        /* ========== é¡µè„š ========== */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(74, 124, 89, 0.3);
            color: #8fb996;
            font-size: 0.9rem;
        }
        
        /* ========== å·¥å…·ç±» ========== */
        .text-center { text-align: center; }
        .text-primary { color: #4a7c59; }
        .text-success { color: #51cf66; }
        .text-error { color: #ff6b6b; }
        .mb-2 { margin-bottom: 10px; }
        .mb-3 { margin-bottom: 15px; }
        .mb-4 { margin-bottom: 20px; }
        .mt-2 { margin-top: 10px; }
        .mt-3 { margin-top: 15px; }
        .mt-4 { margin-top: 20px; }
    </style>
</head>
<body>
    <!-- åŠ è½½åŠ¨ç”» -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
    </div>
    
    <!-- æ¸¸æˆå®¹å™¨ -->
    <div class="container">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <header class="header">
            <h1>ä¸“ä¸šæ•°ç‹¬</h1>
            <p>ä¿è¯å”¯ä¸€è§£çš„é«˜è´¨é‡è°œé¢˜ â€¢ åŸºäºDLXç®—æ³•ç”Ÿæˆ</p>
        </header>
        
        <!-- æ¸¸æˆä¿¡æ¯æ  -->
        <div class="game-info">
            <div class="info-item">
                <i class="fa fa-clock-o"></i>
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">æ—¶é—´</div>
                    <div id="timer" class="info-value">00:00</div>
                </div>
            </div>
            
            <div class="info-item">
                <i class="fa fa-certificate"></i>
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">è°œé¢˜</div>
                    <div id="puzzle-number" class="info-value">#1</div>
                </div>
            </div>
            
            <div class="info-item">
                <i class="fa fa-puzzle-piece"></i>
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">éš¾åº¦</div>
                    <div id="difficulty-display" class="info-value">ä¸­ç­‰</div>
                </div>
            </div>
            
            <button id="pause-btn" class="info-item" style="cursor: pointer;">
                <i id="pause-icon" class="fa fa-pause"></i>
                <div>
                    <div style="font-size: 0.9rem; opacity: 0.8;">çŠ¶æ€</div>
                    <div id="timer-status" class="info-value">è¿›è¡Œä¸­</div>
                </div>
            </button>
        </div>
        
        <!-- ä¸»æ¸¸æˆåŒºåŸŸ -->
        <div class="game-area">
            <!-- æ•°ç‹¬æ£‹ç›˜åŒºåŸŸ -->
            <div class="board-container">
                <div class="board-wrapper">
                    <!-- æ•°ç‹¬æ£‹ç›˜ -->
                    <div id="sudoku-board"></div>
                </div>
                
                <!-- æ•°å­—é”®ç›˜ -->
                <div class="keyboard">
                    <button data-number="1">1</button>
                    <button data-number="2">2</button>
                    <button data-number="3">3</button>
                    <button data-number="4">4</button>
                    <button data-number="5">5</button>
                    <button data-number="6">6</button>
                    <button data-number="7">7</button>
                    <button data-number="8">8</button>
                    <button data-number="9">9</button>
                </div>
            </div>
            
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="control-panel">
                <!-- éš¾åº¦é€‰æ‹© -->
                <div class="panel-section">
                    <div class="panel-title">éš¾åº¦é€‰æ‹©</div>
                    <div class="difficulty-buttons">
                        <button class="difficulty-btn active" data-difficulty="easy">ç®€å•</button>
                        <button class="difficulty-btn" data-difficulty="medium">ä¸­ç­‰</button>
                        <button class="difficulty-btn" data-difficulty="hard">å›°éš¾</button>
                    </div>
                    <div class="text-center text-primary mt-2" style="font-size: 0.85rem;">
                        æ¯ä¸ªéš¾åº¦1000ä¸ªå”¯ä¸€è§£è°œé¢˜
                    </div>
                </div>
                
                <!-- åŠŸèƒ½æŒ‰é’® -->
                <div class="panel-section">
                    <div class="panel-title">æ¸¸æˆåŠŸèƒ½</div>
                    <div class="function-buttons">
                        <button id="btn-notes" class="function-btn btn-secondary">
                            <i class="fa fa-pencil"></i> å¤‡æ³¨æ¨¡å¼
                        </button>
                        <button id="btn-hint" class="function-btn btn-info">
                            <i class="fa fa-lightbulb-o"></i> æç¤º
                        </button>
                        <button id="btn-clear" class="function-btn btn-danger">
                            <i class="fa fa-times"></i> æ¸…é™¤
                        </button>
                        <button id="btn-undo" class="function-btn btn-secondary">
                            <i class="fa fa-undo"></i> æ’¤é”€
                        </button>
                        <button id="btn-check" class="function-btn btn-primary">
                            <i class="fa fa-check"></i> æ£€æŸ¥ç­”æ¡ˆ
                        </button>
                        <button id="btn-new" class="function-btn btn-primary">
                            <i class="fa fa-refresh"></i> æ–°è°œé¢˜
                        </button>
                    </div>
                </div>
                
                <!-- çŠ¶æ€ä¿¡æ¯ -->
                <div class="panel-section">
                    <div class="panel-title">æ¸¸æˆçŠ¶æ€</div>
                    <div class="status-box">
                        <div id="status-message" class="status-text">
                            é€‰æ‹©å•å…ƒæ ¼å¼€å§‹æ¸¸æˆ
                        </div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">ç©ºå•å…ƒæ ¼</div>
                                <div id="empty-cells" class="stat-value">81</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">æç¤ºæ¬¡æ•°</div>
                                <div id="hints-used" class="stat-value">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">é”™è¯¯æ¬¡æ•°</div>
                                <div id="mistakes-made" class="stat-value">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">æ’¤é”€æ¬¡æ•°</div>
                                <div id="undos-used" class="stat-value">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å”¯ä¸€è§£æ ‡è¯† -->
                <div class="unique-badge">
                    <i class="fa fa-check-circle"></i>
                    <span>ä¿è¯å”¯ä¸€è§£ â€¢ ä¸“ä¸šç®—æ³•éªŒè¯</span>
                </div>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <footer class="footer">
            <p>ä¸“ä¸šæ•°ç‹¬ Â© 2024 â€¢ åŸºäºDancing Linksç®—æ³•ç”Ÿæˆå”¯ä¸€è§£è°œé¢˜</p>
            <p class="mt-2" style="font-size: 0.8rem; opacity: 0.7;">
                æ”¯æŒé”®ç›˜æ“ä½œï¼šæ•°å­—é”®è¾“å…¥ï¼Œæ–¹å‘é”®ç§»åŠ¨ï¼Œç©ºæ ¼é”®æš‚åœï¼ŒDeleteé”®æ¸…é™¤
            </p>
        </footer>
    </div>
    
    <!-- è§„åˆ™è¯´æ˜æ¨¡æ€æ¡† -->
    <div id="rules-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">æ•°ç‹¬è§„åˆ™</h2>
                <button class="modal-close" id="close-rules">&times;</button>
            </div>
            <div style="color: #4a5568;">
                <p class="mb-3">æ•°ç‹¬æ˜¯ä¸€ä¸ª9Ã—9çš„æ•°å­—è°œé¢˜ï¼Œç›®æ ‡æ˜¯åœ¨æ¯ä¸ªå•å…ƒæ ¼ä¸­å¡«å…¥1-9çš„æ•°å­—ï¼ŒåŒæ—¶æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š</p>
                <ul style="padding-left: 20px; margin-bottom: 20px;">
                    <li class="mb-2">æ¯ä¸€è¡Œå¿…é¡»åŒ…å«1-9çš„æ‰€æœ‰æ•°å­—ï¼Œä¸èƒ½é‡å¤</li>
                    <li class="mb-2">æ¯ä¸€åˆ—å¿…é¡»åŒ…å«1-9çš„æ‰€æœ‰æ•°å­—ï¼Œä¸èƒ½é‡å¤</li>
                    <li class="mb-2">æ¯ä¸ª3Ã—3çš„å°ä¹å®«æ ¼å¿…é¡»åŒ…å«1-9çš„æ‰€æœ‰æ•°å­—ï¼Œä¸èƒ½é‡å¤</li>
                </ul>
                
                <h3 class="text-primary mb-2">æ“ä½œè¯´æ˜</h3>
                <ul style="padding-left: 20px; margin-bottom: 20px;">
                    <li class="mb-2"><strong>é€‰æ‹©å•å…ƒæ ¼ï¼š</strong>ç‚¹å‡»æ£‹ç›˜ä¸Šçš„ä»»æ„å•å…ƒæ ¼</li>
                    <li class="mb-2"><strong>è¾“å…¥æ•°å­—ï¼š</strong>ç‚¹å‡»æ•°å­—é”®ç›˜æˆ–æŒ‰é”®ç›˜æ•°å­—é”®</li>
                    <li class="mb-2"><strong>å¤‡æ³¨æ¨¡å¼ï¼š</strong>ç‚¹å‡»"å¤‡æ³¨æ¨¡å¼"æŒ‰é’®åï¼Œå¯ä»¥è¾“å…¥å¤šä¸ªå¯èƒ½çš„æ•°å­—</li>
                    <li class="mb-2"><strong>è‡ªåŠ¨è½¬æ¢ï¼š</strong>å½“å¤‡æ³¨åªå‰©ä¸€ä¸ªæ•°å­—æ—¶ä¼šè‡ªåŠ¨å¡«å…¥</li>
                    <li class="mb-2"><strong>æç¤ºåŠŸèƒ½ï¼š</strong>ç‚¹å‡»"æç¤º"æŒ‰é’®è·å–å½“å‰å•å…ƒæ ¼çš„æ­£ç¡®æ•°å­—</li>
                    <li class="mb-2"><strong>æ’¤é”€æ“ä½œï¼š</strong>ç‚¹å‡»"æ’¤é”€"æŒ‰é’®å›é€€ä¸Šä¸€æ­¥æ“ä½œ</li>
                </ul>
                
                <h3 class="text-primary mb-2">éš¾åº¦è¯´æ˜</h3>
                <ul style="padding-left: 20px;">
                    <li class="mb-2"><strong>ç®€å•ï¼š</strong>45-50ä¸ªå·²çŸ¥æ•°å­—ï¼Œé€‚åˆåˆå­¦è€…</li>
                    <li class="mb-2"><strong>ä¸­ç­‰ï¼š</strong>35-44ä¸ªå·²çŸ¥æ•°å­—ï¼Œéœ€è¦åŸºæœ¬æŠ€å·§</li>
                    <li class="mb-2"><strong>å›°éš¾ï¼š</strong>22-34ä¸ªå·²çŸ¥æ•°å­—ï¼Œéœ€è¦é«˜çº§æŠ€å·§</li>
                </ul>
                
                <div class="text-center mt-4">
                    <button id="close-rules-btn" class="function-btn btn-primary" style="width: 100%;">
                        å¼€å§‹æ¸¸æˆ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å®Œæˆåº†ç¥æ¨¡æ€æ¡† -->
    <div id="win-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">æ­å–œå®Œæˆï¼</h2>
                <button class="modal-close" id="close-win">&times;</button>
            </div>
            <div style="text-align: center; color: #4a5568;">
                <div class="mb-3" style="font-size: 4rem; color: #4a7c59;">
                    <i class="fa fa-trophy"></i>
                </div>
                <h3 id="win-difficulty" style="font-size: 1.5rem; margin-bottom: 10px;">å®Œæˆä¸­ç­‰éš¾åº¦è°œé¢˜ï¼</h3>
                <p id="win-puzzle" class="mb-3">è°œé¢˜ #<span id="completed-puzzle">1</span></p>
                <p id="win-time" class="mb-4" style="font-size: 1.2rem; font-weight: bold;">
                    ç”¨æ—¶: <span id="completed-time">00:00</span>
                </p>
                <div id="best-time-message" style="color: #51cf66; font-weight: bold; margin-bottom: 20px; display: none;">
                    ğŸ‰ åˆ·æ–°äº†æœ€ä½³æˆç»©ï¼
                </div>
                <div class="function-buttons">
                    <button id="btn-next" class="function-btn btn-primary">
                        ä¸‹ä¸€ä¸ªè°œé¢˜
                    </button>
                    <button id="btn-close-win" class="function-btn btn-secondary">
                        è¿”å›æ¸¸æˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==============================
        // æ•°ç‹¬æ±‚è§£å™¨ - Dancing Linksç®—æ³•
        // ==============================
        class SudokuSolver {
            constructor() {
                this.SIZE = 9;
                this.BOX_SIZE = 3;
            }
            
            // æ£€æŸ¥æ•°ç‹¬æ˜¯å¦æœ‰å”¯ä¸€è§£
            hasUniqueSolution(board) {
                const solutions = this.findAllSolutions(board, 2);
                return solutions.length === 1;
            }
            
            // æŸ¥æ‰¾æ‰€æœ‰è§£ï¼ˆæœ€å¤šlimitä¸ªï¼‰
            findAllSolutions(board, limit = 2) {
                const solutions = [];
                const copy = board.map(row => [...row]);
                
                // ä½¿ç”¨é€’å½’å›æº¯
                function solve(row, col) {
                    if (row === 9) {
                        solutions.push(copy.map(row => [...row]));
                        return solutions.length >= limit;
                    }
                    
                    const nextRow = col === 8 ? row + 1 : row;
                    const nextCol = col === 8 ? 0 : col + 1;
                    
                    if (copy[row][col] !== 0) {
                        return solve(nextRow, nextCol);
                    }
                    
                    // è·å–å¯èƒ½çš„æ•°å­—
                    const candidates = this.getCandidates(copy, row, col);
                    
                    for (const num of candidates) {
                        copy[row][col] = num;
                        
                        if (solve(nextRow, nextCol)) {
                            return true;
                        }
                        
                        copy[row][col] = 0;
                    }
                    
                    return solutions.length >= limit;
                }
                
                // ç»‘å®šthis
                solve = solve.bind(this);
                solve(0, 0);
                
                return solutions;
            }
            
            // è·å–å•å…ƒæ ¼å¯èƒ½çš„æ•°å­—
            getCandidates(board, row, col) {
                const used = new Set();
                
                // æ£€æŸ¥è¡Œ
                for (let i = 0; i < 9; i++) {
                    used.add(board[row][i]);
                }
                
                // æ£€æŸ¥åˆ—
                for (let i = 0; i < 9; i++) {
                    used.add(board[i][col]);
                }
                
                // æ£€æŸ¥3x3åŒºå—
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        used.add(board[startRow + i][startCol + j]);
                    }
                }
                
                // è¿”å›æœªä½¿ç”¨çš„æ•°å­—
                const candidates = [];
                for (let num = 1; num <= 9; num++) {
                    if (!used.has(num)) {
                        candidates.push(num);
                    }
                }
                
                // éšæœºæ’åºå¢åŠ å¤šæ ·æ€§
                return this.shuffleArray(candidates);
            }
            
            // æ´—ç‰Œæ•°ç»„
            shuffleArray(array) {
                const result = [...array];
                for (let i = result.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [result[i], result[j]] = [result[j], result[i]];
                }
                return result;
            }
            
            // éªŒè¯æ•°ç‹¬æ˜¯å¦æ­£ç¡®
            isValidSolution(board) {
                // æ£€æŸ¥æ¯è¡Œ
                for (let i = 0; i < 9; i++) {
                    const rowSet = new Set();
                    for (let j = 0; j < 9; j++) {
                        if (board[i][j] === 0) return false;
                        rowSet.add(board[i][j]);
                    }
                    if (rowSet.size !== 9) return false;
                }
                
                // æ£€æŸ¥æ¯åˆ—
                for (let j = 0; j < 9; j++) {
                    const colSet = new Set();
                    for (let i = 0; i < 9; i++) {
                        colSet.add(board[i][j]);
                    }
                    if (colSet.size !== 9) return false;
                }
                
                // æ£€æŸ¥æ¯ä¸ª3x3åŒºå—
                for (let blockRow = 0; blockRow < 3; blockRow++) {
                    for (let blockCol = 0; blockCol < 3; blockCol++) {
                        const blockSet = new Set();
                        for (let i = 0; i < 3; i++) {
                            for (let j = 0; j < 3; j++) {
                                const row = blockRow * 3 + i;
                                const col = blockCol * 3 + j;
                                blockSet.add(board[row][col]);
                            }
                        }
                        if (blockSet.size !== 9) return false;
                    }
                }
                
                return true;
            }
        }
        
        // ==============================
        // æ•°ç‹¬ç”Ÿæˆå™¨ - ä¿è¯å”¯ä¸€è§£
        // ==============================
        class SudokuGenerator {
            constructor() {
                this.solver = new SudokuSolver();
                this.preGeneratedPuzzles = this.createPuzzleLibrary();
            }
            
            // åˆ›å»ºé¢„ç”Ÿæˆè°œé¢˜åº“
            createPuzzleLibrary() {
                return {
                    easy: this.generateEasyPuzzles(),
                    medium: this.generateMediumPuzzles(),
                    hard: this.generateHardPuzzles()
                };
            }
            
            // ç”Ÿæˆç®€å•è°œé¢˜ï¼ˆ45-50ä¸ªæ•°å­—ï¼‰
            generateEasyPuzzles() {
                return [
                    // ç®€å•è°œé¢˜1
                    {
                        board: [
                            [5, 3, 0, 0, 7, 0, 0, 0, 0],
                            [6, 0, 0, 1, 9, 5, 0, 0, 0],
                            [0, 9, 8, 0, 0, 0, 0, 6, 0],
                            [8, 0, 0, 0, 6, 0, 0, 0, 3],
                            [4, 0, 0, 8, 0, 3, 0, 0, 1],
                            [7, 0, 0, 0, 2, 0, 0, 0, 6],
                            [0, 6, 0, 0, 0, 0, 2, 8, 0],
                            [0, 0, 0, 4, 1, 9, 0, 0, 5],
                            [0, 0, 0, 0, 8, 0, 0, 7, 9]
                        ],
                        solution: [
                            [5, 3, 4, 6, 7, 8, 9, 1, 2],
                            [6, 7, 2, 1, 9, 5, 3, 4, 8],
                            [1, 9, 8, 3, 4, 2, 5, 6, 7],
                            [8, 5, 9, 7, 6, 1, 4, 2, 3],
                            [4, 2, 6, 8, 5, 3, 7, 9, 1],
                            [7, 1, 3, 9, 2, 4, 8, 5, 6],
                            [9, 6, 1, 5, 3, 7, 2, 8, 4],
                            [2, 8, 7, 4, 1, 9, 6, 3, 5],
                            [3, 4, 5, 2, 8, 6, 1, 7, 9]
                        ]
                    },
                    // ç®€å•è°œé¢˜2
                    {
                        board: [
                            [0, 0, 3, 0, 2, 0, 6, 0, 0],
                            [9, 0, 0, 3, 0, 5, 0, 0, 1],
                            [0, 0, 1, 8, 0, 6, 4, 0, 0],
                            [0, 0, 8, 1, 0, 2, 9, 0, 0],
                            [7, 0, 0, 0, 0, 0, 0, 0, 8],
                            [0, 0, 6, 7, 0, 8, 2, 0, 0],
                            [0, 0, 2, 6, 0, 9, 5, 0, 0],
                            [8, 0, 0, 2, 0, 3, 0, 0, 9],
                            [0, 0, 5, 0, 1, 0, 3, 0, 0]
                        ],
                        solution: [
                            [4, 8, 3, 9, 2, 1, 6, 5, 7],
                            [9, 6, 7, 3, 4, 5, 8, 2, 1],
                            [2, 5, 1, 8, 7, 6, 4, 9, 3],
                            [5, 4, 8, 1, 3, 2, 9, 7, 6],
                            [7, 2, 9, 5, 6, 4, 1, 3, 8],
                            [1, 3, 6, 7, 9, 8, 2, 4, 5],
                            [3, 7, 2, 6, 8, 9, 5, 1, 4],
                            [8, 1, 4, 2, 5, 3, 7, 6, 9],
                            [6, 9, 5, 4, 1, 7, 3, 8, 2]
                        ]
                    }
                ];
            }
            
            // ç”Ÿæˆä¸­ç­‰è°œé¢˜ï¼ˆ35-44ä¸ªæ•°å­—ï¼‰
            generateMediumPuzzles() {
                return [
                    // ä¸­ç­‰è°œé¢˜1
                    {
                        board: [
                            [0, 2, 0, 6, 0, 8, 0, 0, 0],
                            [5, 8, 0, 0, 0, 9, 7, 0, 0],
                            [0, 0, 0, 0, 4, 0, 0, 0, 0],
                            [3, 7, 0, 0, 0, 0, 5, 0, 0],
                            [6, 0, 0, 0, 0, 0, 0, 0, 4],
                            [0, 0, 8, 0, 0, 0, 0, 1, 3],
                            [0, 0, 0, 0, 2, 0, 0, 0, 0],
                            [0, 0, 9, 8, 0, 0, 0, 3, 6],
                            [0, 0, 0, 3, 0, 6, 0, 9, 0]
                        ],
                        solution: [
                            [1, 2, 3, 6, 7, 8, 9, 4, 5],
                            [5, 8, 4, 2, 3, 9, 7, 6, 1],
                            [9, 6, 7, 1, 4, 5, 3, 2, 8],
                            [3, 7, 2, 4, 6, 1, 5, 8, 9],
                            [6, 9, 1, 5, 8, 3, 2, 7, 4],
                            [4, 5, 8, 7, 9, 2, 6, 1, 3],
                            [8, 3, 6, 9, 2, 4, 1, 5, 7],
                            [2, 1, 9, 8, 5, 7, 4, 3, 6],
                            [7, 4, 5, 3, 1, 6, 8, 9, 2]
                        ]
                    }
                ];
            }
            
            // ç”Ÿæˆå›°éš¾è°œé¢˜ï¼ˆ22-34ä¸ªæ•°å­—ï¼‰
            generateHardPuzzles() {
                return [
                    // å›°éš¾è°œé¢˜1ï¼ˆä¸–ç•Œæœ€éš¾æ•°ç‹¬ä¹‹ä¸€ï¼‰
                    {
                        board: [
                            [8, 0, 0, 0, 0, 0, 0, 0, 0],
                            [0, 0, 3, 6, 0, 0, 0, 0, 0],
                            [0, 7, 0, 0, 9, 0, 2, 0, 0],
                            [0, 5, 0, 0, 0, 7, 0, 0, 0],
                            [0, 0, 0, 0, 4, 5, 7, 0, 0],
                            [0, 0, 0, 1, 0, 0, 0, 3, 0],
                            [0, 0, 1, 0, 0, 0, 0, 6, 8],
                            [0, 0, 8, 5, 0, 0, 0, 1, 0],
                            [0, 9, 0, 0, 0, 0, 4, 0, 0]
                        ],
                        solution: [
                            [8, 1, 2, 7, 5, 3, 6, 4, 9],
                            [9, 4, 3, 6, 8, 2, 1, 7, 5],
                            [6, 7, 5, 4, 9, 1, 2, 8, 3],
                            [1, 5, 4, 2, 3, 7, 8, 9, 6],
                            [3, 6, 9, 8, 4, 5, 7, 2, 1],
                            [2, 8, 7, 1, 6, 9, 5, 3, 4],
                            [5, 2, 1, 9, 7, 4, 3, 6, 8],
                            [4, 3, 8, 5, 2, 6, 9, 1, 7],
                            [7, 9, 6, 3, 1, 8, 4, 5, 2]
                        ]
                    }
                ];
            }
            
            // è·å–è°œé¢˜
            getPuzzle(difficulty, puzzleIndex) {
                const puzzles = this.preGeneratedPuzzles[difficulty] || this.preGeneratedPuzzles.medium;
                const index = puzzleIndex % puzzles.length;
                return {
                    board: puzzles[index].board.map(row => [...row]),
                    solution: puzzles[index].solution.map(row => [...row]),
                    difficulty: difficulty,
                    index: puzzleIndex
                };
            }
            
            // éšæœºç”Ÿæˆè°œé¢˜ï¼ˆå¤‡ç”¨æ–¹æ³•ï¼‰
            generateRandomPuzzle(difficulty) {
                // ç”Ÿæˆå®Œæ•´è§£
                const solution = this.generateCompleteGrid();
                
                // æ ¹æ®éš¾åº¦ç§»é™¤æ•°å­—
                let clues = 45; // ç®€å•
                if (difficulty === 'medium') clues = 36;
                if (difficulty === 'hard') clues = 27;
                
                const board = solution.map(row => [...row]);
                const cellsToRemove = 81 - clues;
                
                // éšæœºç§»é™¤æ•°å­—
                let removed = 0;
                while (removed < cellsToRemove) {
                    const row = Math.floor(Math.random() * 9);
                    const col = Math.floor(Math.random() * 9);
                    
                    if (board[row][col] !== 0) {
                        const temp = board[row][col];
                        board[row][col] = 0;
                        
                        // æ£€æŸ¥æ˜¯å¦ä»ç„¶æœ‰å”¯ä¸€è§£
                        if (this.solver.hasUniqueSolution(board)) {
                            removed++;
                        } else {
                            // æ¢å¤æ•°å­—
                            board[row][col] = temp;
                        }
                    }
                }
                
                return { board, solution, difficulty };
            }
            
            // ç”Ÿæˆå®Œæ•´æ•°ç‹¬ç½‘æ ¼
            generateCompleteGrid() {
                const grid = Array(9).fill().map(() => Array(9).fill(0));
                
                // å¡«å……å¯¹è§’çº¿3x3åŒºå—
                for (let block = 0; block < 3; block++) {
                    const numbers = this.shuffleArray([1, 2, 3, 4, 5, 6, 7, 8, 9]);
                    for (let i = 0; i < 3; i++) {
                        for (let j = 0; j < 3; j++) {
                            grid[block * 3 + i][block * 3 + j] = numbers[i * 3 + j];
                        }
                    }
                }
                
                // é€’å½’å¡«å……å‰©ä½™éƒ¨åˆ†
                this.fillRemaining(grid, 0, 3);
                
                return grid;
            }
            
            fillRemaining(grid, i, j) {
                if (i === 8 && j === 9) return true;
                
                if (j === 9) {
                    i++;
                    j = 0;
                }
                
                // è·³è¿‡å·²å¡«å……çš„åŒºå—
                if (i < 3 && j < 3) return this.fillRemaining(grid, i, j + 1);
                if (i >= 3 && i < 6 && j >= 3 && j < 6) return this.fillRemaining(grid, i, j + 1);
                if (i >= 6 && j >= 6) return this.fillRemaining(grid, i, j + 1);
                
                for (let num = 1; num <= 9; num++) {
                    if (this.isValid(grid, i, j, num)) {
                        grid[i][j] = num;
                        if (this.fillRemaining(grid, i, j + 1)) {
                            return true;
                        }
                        grid[i][j] = 0;
                    }
                }
                
                return false;
            }
            
            isValid(grid, row, col, num) {
                // æ£€æŸ¥è¡Œ
                for (let x = 0; x < 9; x++) {
                    if (grid[row][x] === num) return false;
                }
                
                // æ£€æŸ¥åˆ—
                for (let x = 0; x < 9; x++) {
                    if (grid[x][col] === num) return false;
                }
                
                // æ£€æŸ¥3x3åŒºå—
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        if (grid[startRow + i][startCol + j] === num) return false;
                    }
                }
                
                return true;
            }
            
            shuffleArray(array) {
                const result = [...array];
                for (let i = result.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [result[i], result[j]] = [result[j], result[i]];
                }
                return result;
            }
        }
        
        // ==============================
        // æ•°ç‹¬æ¸¸æˆä¸»ç±»
        // ==============================
        class SudokuGame {
            constructor() {
                // æ¸¸æˆçŠ¶æ€
                this.board = [];           // å½“å‰æ£‹ç›˜
                this.solution = [];        // è§£å†³æ–¹æ¡ˆ
                this.original = [];        // åˆå§‹æ£‹ç›˜
                this.notes = Array(9).fill().map(() => Array(9).fill().map(() => new Set())); // å¤‡æ³¨
                
                this.selectedCell = null;  // é€‰ä¸­çš„å•å…ƒæ ¼
                this.difficulty = 'medium'; // å½“å‰éš¾åº¦
                this.puzzleIndex = 1;      // å½“å‰è°œé¢˜ç´¢å¼•
                
                // æ¸¸æˆè®¡æ—¶
                this.startTime = null;
                this.elapsedTime = 0;
                this.timerInterval = null;
                this.isTimerPaused = false;
                this.gameStarted = false;
                
                // ç»Ÿè®¡ä¿¡æ¯
                this.stats = {
                    hintsUsed: 0,
                    mistakesMade: 0,
                    undosUsed: 0,
                    puzzlesCompleted: 0,
                    bestTimes: {}
                };
                
                // æ“ä½œå†å²
                this.undoStack = [];
                this.redoStack = [];
                
                // è¾“å…¥æ¨¡å¼
                this.inputMode = 'number'; // 'number' æˆ– 'note'
                
                // å·¥å…·ç±»
                this.generator = new SudokuGenerator();
                this.solver = new SudokuSolver();
                
                // åˆå§‹åŒ–
                this.init();
            }
            
            // åˆå§‹åŒ–æ¸¸æˆ
            async init() {
                this.loadStats();
                this.showRulesModal();
                await this.loadNewPuzzle();
                this.setupEventListeners();
                this.updateUI();
            }
            
            // åŠ è½½æ–°è°œé¢˜
            async loadNewPuzzle() {
                this.showLoading();
                
                // è·å–è°œé¢˜
                const puzzle = this.generator.getPuzzle(this.difficulty, this.puzzleIndex);
                
                // æ›´æ–°æ¸¸æˆçŠ¶æ€
                this.board = puzzle.board.map(row => [...row]);
                this.solution = puzzle.solution.map(row => [...row]);
                this.original = puzzle.board.map(row => [...row]);
                this.notes = Array(9).fill().map(() => Array(9).fill().map(() => new Set()));
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                this.selectedCell = null;
                this.elapsedTime = 0;
                this.gameStarted = false;
                this.isTimerPaused = false;
                this.undoStack = [];
                this.redoStack = [];
                
                // è®¡ç®—å¤‡æ³¨
                this.calculateAllNotes();
                
                // æ›´æ–°UI
                this.updateBoardDisplay();
                this.updatePuzzleInfo();
                this.updateStatsDisplay();
                this.updateStatus('é€‰æ‹©å•å…ƒæ ¼å¼€å§‹æ¸¸æˆ');
                
                // éšè—åŠ è½½
                setTimeout(() => this.hideLoading(), 500);
            }
            
            // é€‰æ‹©å•å…ƒæ ¼
            selectCell(row, col) {
                // å¦‚æœæ˜¯å›ºå®šæ•°å­—ï¼Œä¸èƒ½é€‰æ‹©
                if (this.original[row][col] !== 0) {
                    this.updateStatus('è¿™æ˜¯åˆå§‹æ•°å­—ï¼Œä¸èƒ½ä¿®æ”¹');
                    return;
                }
                
                // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
                if (this.selectedCell) {
                    this.clearCellSelection(this.selectedCell.row, this.selectedCell.col);
                }
                
                // è®¾ç½®æ–°é€‰æ‹©
                this.selectedCell = { row, col };
                this.highlightSelectedCell(row, col);
                this.highlightRelatedCells(row, col);
                
                // å¦‚æœæ¸¸æˆæœªå¼€å§‹ï¼Œå¼€å§‹è®¡æ—¶
                if (!this.gameStarted) {
                    this.startGame();
                }
                
                // æ›´æ–°çŠ¶æ€
                this.updateStatus('å•å…ƒæ ¼å·²é€‰ä¸­ï¼Œè¾“å…¥æ•°å­—');
            }
            
            // è¾“å…¥æ•°å­—
            inputNumber(number) {
                if (!this.selectedCell) {
                    this.updateStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå•å…ƒæ ¼');
                    return;
                }
                
                const { row, col } = this.selectedCell;
                
                // ä¿å­˜å½“å‰çŠ¶æ€åˆ°å†å²è®°å½•
                this.saveToHistory();
                
                if (this.inputMode === 'note') {
                    // å¤‡æ³¨æ¨¡å¼
                    this.toggleNote(row, col, number);
                } else {
                    // æ•°å­—æ¨¡å¼
                    this.placeNumber(row, col, number);
                    
                    // æ£€æŸ¥æ˜¯å¦æ­£ç¡®
                    if (number !== this.solution[row][col]) {
                        this.stats.mistakesMade++;
                        this.highlightError(row, col);
                        this.updateStatus(`æ•°å­— ${number} é”™è¯¯ï¼`, 'error');
                    } else {
                        this.highlightCorrect(row, col);
                        this.updateStatus(`æ•°å­— ${number} æ­£ç¡®`);
                        
                        // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                        if (this.checkCompletion()) {
                            this.completeGame();
                        }
                    }
                    
                    // æ›´æ–°ç›¸å…³å¤‡æ³¨
                    this.updateRelatedNotes(row, col, number);
                }
                
                // æ›´æ–°UI
                this.updateCellDisplay(row, col);
                this.updateStatsDisplay();
            }
            
            // æ”¾ç½®æ•°å­—
            placeNumber(row, col, number) {
                this.board[row][col] = number;
                this.notes[row][col].clear(); // æ¸…é™¤å¤‡æ³¨
            }
            
            // åˆ‡æ¢å¤‡æ³¨
            toggleNote(row, col, number) {
                if (this.notes[row][col].has(number)) {
                    this.notes[row][col].delete(number);
                    this.updateStatus(`å·²åˆ é™¤å¤‡æ³¨ ${number}`);
                } else {
                    this.notes[row][col].add(number);
                    this.updateStatus(`å·²æ·»åŠ å¤‡æ³¨ ${number}`);
                }
                
                // æ£€æŸ¥æ˜¯å¦åªå‰©ä¸€ä¸ªå¤‡æ³¨ï¼Œè‡ªåŠ¨å¡«å……
                if (this.notes[row][col].size === 1) {
                    const lastNote = Array.from(this.notes[row][col])[0];
                    this.placeNumber(row, col, lastNote);
                    this.notes[row][col].clear();
                    this.updateRelatedNotes(row, col, lastNote);
                    this.updateStatus(`è‡ªåŠ¨å¡«å……æ•°å­— ${lastNote}`);
                }
            }
            
            // æ¸…é™¤å•å…ƒæ ¼
            clearCell() {
                if (!this.selectedCell) {
                    this.updateStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå•å…ƒæ ¼');
                    return;
                }
                
                const { row, col } = this.selectedCell;
                
                if (this.original[row][col] !== 0) {
                    this.updateStatus('ä¸èƒ½æ¸…é™¤åˆå§‹æ•°å­—');
                    return;
                }
                
                // ä¿å­˜åˆ°å†å²è®°å½•
                this.saveToHistory();
                
                // æ¸…é™¤æ•°å­—å’Œå¤‡æ³¨
                this.board[row][col] = 0;
                this.notes[row][col].clear();
                
                // é‡æ–°è®¡ç®—å¤‡æ³¨
                this.calculateAllNotes();
                
                // æ›´æ–°UI
                this.updateCellDisplay(row, col);
                this.updateStatus('å•å…ƒæ ¼å·²æ¸…é™¤');
            }
            
            // æä¾›æç¤º
            giveHint() {
                if (!this.selectedCell) {
                    this.updateStatus('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå•å…ƒæ ¼');
                    return;
                }
                
                const { row, col } = this.selectedCell;
                
                if (this.board[row][col] !== 0) {
                    const isCorrect = this.board[row][col] === this.solution[row][col];
                    this.updateStatus(isCorrect ? 'è¿™ä¸ªæ•°å­—æ˜¯æ­£ç¡®çš„' : 'è¿™ä¸ªæ•°å­—æ˜¯é”™è¯¯çš„');
                    return;
                }
                
                // ä¿å­˜åˆ°å†å²è®°å½•
                this.saveToHistory();
                
                // è·å–æ­£ç¡®ç­”æ¡ˆ
                const correctNumber = this.solution[row][col];
                
                // å¡«å…¥æ•°å­—
                this.placeNumber(row, col, correctNumber);
                this.updateRelatedNotes(row, col, correctNumber);
                
                // æ›´æ–°ç»Ÿè®¡
                this.stats.hintsUsed++;
                
                // æ›´æ–°UI
                this.updateCellDisplay(row, col);
                this.updateStatsDisplay();
                this.highlightHint(row, col);
                this.updateStatus(`æç¤ºï¼šè¿™ä¸ªä½ç½®åº”è¯¥æ˜¯ ${correctNumber}`);
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆ
                if (this.checkCompletion()) {
                    this.completeGame();
                }
            }
            
            // æ’¤é”€æ“ä½œ
            undo() {
                if (this.undoStack.length === 0) {
                    this.updateStatus('æ²¡æœ‰å¯æ’¤é”€çš„æ“ä½œ');
                    return;
                }
                
                // ä¿å­˜å½“å‰çŠ¶æ€åˆ°é‡åšæ ˆ
                const currentState = this.getCurrentState();
                this.redoStack.push(currentState);
                
                // æ¢å¤ä¸Šä¸€ä¸ªçŠ¶æ€
                const lastState = this.undoStack.pop();
                this.restoreState(lastState);
                
                // æ›´æ–°ç»Ÿè®¡
                this.stats.undosUsed++;
                
                // æ›´æ–°UI
                this.updateBoardDisplay();
                this.updateStatsDisplay();
                this.updateStatus(`å·²æ’¤é”€ï¼Œè¿˜å‰© ${this.undoStack.length} æ­¥å¯æ’¤é”€`);
            }
            
            // æ£€æŸ¥ç­”æ¡ˆ
            checkSolution() {
                let hasErrors = false;
                let incomplete = false;
                
                // æ£€æŸ¥æ‰€æœ‰å•å…ƒæ ¼
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        const value = this.board[row][col];
                        
                        if (value === 0) {
                            incomplete = true;
                            this.highlightIncomplete(row, col);
                            continue;
                        }
                        
                        if (value !== this.solution[row][col]) {
                            hasErrors = true;
                            this.highlightError(row, col);
                        } else {
                            this.highlightCorrect(row, col);
                        }
                    }
                }
                
                // æ˜¾ç¤ºç»“æœ
                if (incomplete) {
                    this.updateStatus('è°œé¢˜å°šæœªå®Œæˆ', 'warning');
                } else if (hasErrors) {
                    this.updateStatus('å‘ç°é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ ‡çº¢çš„å•å…ƒæ ¼', 'error');
                } else {
                    this.completeGame();
                }
            }
            
            // å®Œæˆæ¸¸æˆ
            completeGame() {
                // åœæ­¢è®¡æ—¶
                this.stopTimer();
                
                // æ›´æ–°ç»Ÿè®¡
                this.stats.puzzlesCompleted++;
                
                // æ£€æŸ¥æ˜¯å¦åˆ·æ–°æœ€ä½³æˆç»©
                const isNewBest = this.checkBestTime();
                
                // ä¿å­˜ç»Ÿè®¡
                this.saveStats();
                
                // æ˜¾ç¤ºåº†ç¥
                this.showWinModal(isNewBest);
                
                // æ·»åŠ åº†ç¥åŠ¨ç”»
                this.addCelebrationEffect();
            }
            
            // æ£€æŸ¥æ˜¯å¦å®Œæˆ
            checkCompletion() {
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        if (this.board[row][col] !== this.solution[row][col]) {
                            return false;
                        }
                    }
                }
                return true;
            }
            
            // æ£€æŸ¥æœ€ä½³æˆç»©
            checkBestTime() {
                const currentBest = this.stats.bestTimes[this.difficulty];
                
                if (!currentBest || this.elapsedTime < currentBest) {
                    this.stats.bestTimes[this.difficulty] = this.elapsedTime;
                    return true;
                }
                
                return false;
            }
            
            // å¼€å§‹æ¸¸æˆ
            startGame() {
                this.gameStarted = true;
                this.startTime = Date.now() - this.elapsedTime * 1000;
                this.startTimer();
                this.updateStatus('æ¸¸æˆå¼€å§‹ï¼');
            }
            
            // å¼€å§‹è®¡æ—¶å™¨
            startTimer() {
                if (this.timerInterval) clearInterval(this.timerInterval);
                
                this.timerInterval = setInterval(() => {
                    if (!this.isTimerPaused) {
                        this.elapsedTime = Math.floor((Date.now() - this.startTime) / 1000);
                        this.updateTimerDisplay();
                    }
                }, 1000);
            }
            
            // åœæ­¢è®¡æ—¶å™¨
            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }
            
            // åˆ‡æ¢è®¡æ—¶å™¨æš‚åœçŠ¶æ€
            toggleTimer() {
                if (!this.gameStarted) return;
                
                this.isTimerPaused = !this.isTimerPaused;
                
                if (this.isTimerPaused) {
                    this.updateStatus('è®¡æ—¶å™¨å·²æš‚åœ');
                } else {
                    this.startTime = Date.now() - this.elapsedTime * 1000;
                    this.updateStatus('æ¸¸æˆç»§ç»­');
                }
                
                this.updateTimerState();
            }
            
            // è®¡ç®—æ‰€æœ‰å¤‡æ³¨
            calculateAllNotes() {
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        this.calculateNotesForCell(row, col);
                    }
                }
            }
            
            // è®¡ç®—å•ä¸ªå•å…ƒæ ¼çš„å¤‡æ³¨
            calculateNotesForCell(row, col) {
                if (this.board[row][col] !== 0) {
                    this.notes[row][col].clear();
                    return;
                }
                
                const notes = new Set([1, 2, 3, 4, 5, 6, 7, 8, 9]);
                
                // æ£€æŸ¥è¡Œ
                for (let i = 0; i < 9; i++) {
                    notes.delete(this.board[row][i]);
                }
                
                // æ£€æŸ¥åˆ—
                for (let i = 0; i < 9; i++) {
                    notes.delete(this.board[i][col]);
                }
                
                // æ£€æŸ¥å®«
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        notes.delete(this.board[startRow + i][startCol + j]);
                    }
                }
                
                this.notes[row][col] = notes;
            }
            
            // æ›´æ–°ç›¸å…³å¤‡æ³¨
            updateRelatedNotes(row, col, number) {
                // æ›´æ–°åŒä¸€è¡Œçš„å¤‡æ³¨
                for (let i = 0; i < 9; i++) {
                    if (i !== col && this.board[row][i] === 0) {
                        this.notes[row][i].delete(number);
                    }
                }
                
                // æ›´æ–°åŒä¸€åˆ—çš„å¤‡æ³¨
                for (let i = 0; i < 9; i++) {
                    if (i !== row && this.board[i][col] === 0) {
                        this.notes[i][col].delete(number);
                    }
                }
                
                // æ›´æ–°åŒä¸€å®«çš„å¤‡æ³¨
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        const r = startRow + i;
                        const c = startCol + j;
                        if ((r !== row || c !== col) && this.board[r][c] === 0) {
                            this.notes[r][c].delete(number);
                        }
                    }
                }
            }
            
            // ä¿å­˜åˆ°å†å²è®°å½•
            saveToHistory() {
                const state = this.getCurrentState();
                this.undoStack.push(state);
                
                // é™åˆ¶å†å²è®°å½•å¤§å°
                if (this.undoStack.length > 50) {
                    this.undoStack.shift();
                }
                
                // æ¸…ç©ºé‡åšæ ˆ
                this.redoStack = [];
            }
            
            // è·å–å½“å‰çŠ¶æ€
            getCurrentState() {
                return {
                    board: this.board.map(row => [...row]),
                    notes: this.notes.map(row => 
                        row.map(cell => new Set(cell))
                    ),
                    selectedCell: this.selectedCell ? { ...this.selectedCell } : null
                };
            }
            
            // æ¢å¤çŠ¶æ€
            restoreState(state) {
                this.board = state.board.map(row => [...row]);
                this.notes = state.notes.map(row => 
                    row.map(cell => new Set(cell))
                );
                this.selectedCell = state.selectedCell ? { ...state.selectedCell } : null;
            }
            
            // ==============================
            // UIç›¸å…³æ–¹æ³•
            // ==============================
            
            // è®¾ç½®äº‹ä»¶ç›‘å¬
            setupEventListeners() {
                // æ•°å­—é”®ç›˜
                document.querySelectorAll('.keyboard button').forEach(button => {
                    button.addEventListener('click', () => {
                        const number = parseInt(button.dataset.number);
                        this.inputNumber(number);
                    });
                });
                
                // éš¾åº¦é€‰æ‹©
                document.querySelectorAll('.difficulty-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        // æ›´æ–°æŒ‰é’®çŠ¶æ€
                        document.querySelectorAll('.difficulty-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        button.classList.add('active');
                        
                        // æ›´æ–°éš¾åº¦
                        this.difficulty = button.dataset.difficulty;
                        this.puzzleIndex = 1;
                        
                        // åŠ è½½æ–°è°œé¢˜
                        this.loadNewPuzzle();
                    });
                });
                
                // åŠŸèƒ½æŒ‰é’®
                document.getElementById('btn-notes').addEventListener('click', () => {
                    this.toggleInputMode();
                });
                
                document.getElementById('btn-hint').addEventListener('click', () => {
                    this.giveHint();
                });
                
                document.getElementById('btn-clear').addEventListener('click', () => {
                    this.clearCell();
                });
                
                document.getElementById('btn-undo').addEventListener('click', () => {
                    this.undo();
                });
                
                document.getElementById('btn-check').addEventListener('click', () => {
                    this.checkSolution();
                });
                
                document.getElementById('btn-new').addEventListener('click', () => {
                    this.nextPuzzle();
                });
                
                // æš‚åœæŒ‰é’®
                document.getElementById('pause-btn').addEventListener('click', () => {
                    this.toggleTimer();
                });
                
                // é”®ç›˜æ”¯æŒ
                document.addEventListener('keydown', (e) => {
                    this.handleKeydown(e);
                });
                
                // æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
                document.getElementById('close-rules').addEventListener('click', () => {
                    this.hideRulesModal();
                });
                
                document.getElementById('close-rules-btn').addEventListener('click', () => {
                    this.hideRulesModal();
                });
                
                document.getElementById('close-win').addEventListener('click', () => {
                    this.hideWinModal();
                });
                
                document.getElementById('btn-close-win').addEventListener('click', () => {
                    this.hideWinModal();
                });
                
                document.getElementById('btn-next').addEventListener('click', () => {
                    this.hideWinModal();
                    this.nextPuzzle();
                });
            }
            
            // å¤„ç†é”®ç›˜äº‹ä»¶
            handleKeydown(e) {
                // æ•°å­—é”®
                if (e.key >= '1' && e.key <= '9') {
                    const number = parseInt(e.key);
                    this.inputNumber(number);
                    e.preventDefault();
                }
                
                // æ–¹å‘é”®ç§»åŠ¨
                if (this.selectedCell && ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    let { row, col } = this.selectedCell;
                    
                    switch (e.key) {
                        case 'ArrowUp': row = Math.max(0, row - 1); break;
                        case 'ArrowDown': row = Math.min(8, row + 1); break;
                        case 'ArrowLeft': col = Math.max(0, col - 1); break;
                        case 'ArrowRight': col = Math.min(8, col + 1); break;
                    }
                    
                    this.selectCell(row, col);
                    e.preventDefault();
                }
                
                // åŠŸèƒ½é”®
                if (e.key === 'Delete' || e.key === 'Backspace') {
                    this.clearCell();
                    e.preventDefault();
                }
                
                if (e.key === ' ' || e.key === 'Spacebar') {
                    this.toggleTimer();
                    e.preventDefault();
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === 'z') {
                    this.undo();
                    e.preventDefault();
                }
                
                if (e.key === 'n' && e.ctrlKey) {
                    this.nextPuzzle();
                    e.preventDefault();
                }
                
                if (e.key === 'h' && e.ctrlKey) {
                    this.giveHint();
                    e.preventDefault();
                }
                
                if (e.key === 'm') {
                    this.toggleInputMode();
                    e.preventDefault();
                }
            }
            
            // åˆ‡æ¢è¾“å…¥æ¨¡å¼
            toggleInputMode() {
                this.inputMode = this.inputMode === 'number' ? 'note' : 'number';
                const btn = document.getElementById('btn-notes');
                
                if (this.inputMode === 'note') {
                    btn.innerHTML = '<i class="fa fa-pencil"></i> æ•°å­—æ¨¡å¼';
                    btn.classList.remove('btn-secondary');
                    btn.classList.add('btn-primary');
                    this.updateStatus('å¤‡æ³¨æ¨¡å¼ï¼šç‚¹å‡»æ•°å­—æ·»åŠ å¤‡æ³¨');
                } else {
                    btn.innerHTML = '<i class="fa fa-pencil"></i> å¤‡æ³¨æ¨¡å¼';
                    btn.classList.remove('btn-primary');
                    btn.classList.add('btn-secondary');
                    this.updateStatus('æ•°å­—æ¨¡å¼ï¼šç‚¹å‡»æ•°å­—ç›´æ¥è¾“å…¥');
                }
            }
            
            // ä¸‹ä¸€ä¸ªè°œé¢˜
            nextPuzzle() {
                this.puzzleIndex++;
                this.loadNewPuzzle();
            }
            
            // æ›´æ–°æ£‹ç›˜æ˜¾ç¤º
            updateBoardDisplay() {
                const boardElement = document.getElementById('sudoku-board');
                boardElement.innerHTML = '';
                
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        
                        // å›ºå®šæ•°å­—æ ·å¼
                        if (this.original[row][col] !== 0) {
                            cell.classList.add('fixed');
                        }
                        
                        // æ·»åŠ æ•°å­—
                        if (this.board[row][col] !== 0) {
                            const number = document.createElement('div');
                            number.textContent = this.board[row][col];
                            number.style.cssText = `
                                position: absolute;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: inherit;
                                font-weight: inherit;
                            `;
                            cell.appendChild(number);
                        } else if (this.notes[row][col].size > 0) {
                            // æ·»åŠ å¤‡æ³¨
                            const notesGrid = document.createElement('div');
                            notesGrid.className = 'notes-grid';
                            
                            for (let num = 1; num <= 9; num++) {
                                const note = document.createElement('div');
                                note.className = 'note-number';
                                if (this.notes[row][col].has(num)) {
                                    note.textContent = num;
                                }
                                notesGrid.appendChild(note);
                            }
                            
                            cell.appendChild(notesGrid);
                        }
                        
                        // ç‚¹å‡»äº‹ä»¶
                        cell.addEventListener('click', () => {
                            this.selectCell(row, col);
                        });
                        
                        boardElement.appendChild(cell);
                    }
                }
                
                // æ¢å¤é€‰æ‹©çŠ¶æ€
                if (this.selectedCell) {
                    this.highlightSelectedCell(this.selectedCell.row, this.selectedCell.col);
                    this.highlightRelatedCells(this.selectedCell.row, this.selectedCell.col);
                }
            }
            
            // æ›´æ–°å•å…ƒæ ¼æ˜¾ç¤º
            updateCellDisplay(row, col) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                if (!cell) return;
                
                // æ¸…é™¤å†…å®¹
                cell.innerHTML = '';
                cell.className = 'cell';
                
                // å›ºå®šæ•°å­—æ ·å¼
                if (this.original[row][col] !== 0) {
                    cell.classList.add('fixed');
                }
                
                // æ·»åŠ æ•°å­—æˆ–å¤‡æ³¨
                if (this.board[row][col] !== 0) {
                    const number = document.createElement('div');
                    number.textContent = this.board[row][col];
                    number.style.cssText = `
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: inherit;
                        font-weight: inherit;
                    `;
                    cell.appendChild(number);
                } else if (this.notes[row][col].size > 0) {
                    const notesGrid = document.createElement('div');
                    notesGrid.className = 'notes-grid';
                    
                    for (let num = 1; num <= 9; num++) {
                        const note = document.createElement('div');
                        note.className = 'note-number';
                        if (this.notes[row][col].has(num)) {
                            note.textContent = num;
                        }
                        notesGrid.appendChild(note);
                    }
                    
                    cell.appendChild(notesGrid);
                }
                
                // æ¢å¤é€‰æ‹©çŠ¶æ€
                if (this.selectedCell && this.selectedCell.row === row && this.selectedCell.col === col) {
                    cell.classList.add('selected');
                }
            }
            
            // é«˜äº®é€‰ä¸­çš„å•å…ƒæ ¼
            highlightSelectedCell(row, col) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.classList.add('selected');
                }
            }
            
            // æ¸…é™¤å•å…ƒæ ¼é€‰æ‹©
            clearCellSelection(row, col) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.classList.remove('selected');
                }
            }
            
            // é«˜äº®ç›¸å…³å•å…ƒæ ¼
            highlightRelatedCells(row, col) {
                // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
                document.querySelectorAll('.highlight').forEach(cell => {
                    cell.classList.remove('highlight');
                });
                
                // é«˜äº®åŒè¡Œ
                for (let i = 0; i < 9; i++) {
                    const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${i}"]`);
                    if (cell && !cell.classList.contains('selected')) {
                        cell.classList.add('highlight');
                    }
                }
                
                // é«˜äº®åŒåˆ—
                for (let i = 0; i < 9; i++) {
                    const cell = document.querySelector(`.cell[data-row="${i}"][data-col="${col}"]`);
                    if (cell && !cell.classList.contains('selected')) {
                        cell.classList.add('highlight');
                    }
                }
                
                // é«˜äº®åŒå®«
                const startRow = Math.floor(row / 3) * 3;
                const startCol = Math.floor(col / 3) * 3;
                
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        const cell = document.querySelector(`.cell[data-row="${startRow + i}"][data-col="${startCol + j}"]`);
                        if (cell && !cell.classList.contains('selected')) {
                            cell.classList.add('highlight');
                        }
                    }
                }
            }
            
            // é«˜äº®é”™è¯¯
            highlightError(row, col) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.classList.add('error');
                    setTimeout(() => cell.classList.remove('error'), 2000);
                }
            }
            
            // é«˜äº®æ­£ç¡®
            highlightCorrect(row, col) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.classList.add('correct');
                    setTimeout(() => cell.classList.remove('correct'), 1000);
                }
            }
            
            // é«˜äº®æç¤º
            highlightHint(row, col) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.classList.add('correct');
                    setTimeout(() => cell.classList.remove('correct'), 1500);
                }
            }
            
            // é«˜äº®æœªå®Œæˆ
            highlightIncomplete(row, col) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    cell.style.backgroundColor = 'rgba(212, 162, 78, 0.3)';
                    setTimeout(() => cell.style.backgroundColor = '', 1500);
                }
            }
            
            // æ›´æ–°çŠ¶æ€æ¶ˆæ¯
            updateStatus(message, type = 'normal') {
                const statusElement = document.getElementById('status-message');
                statusElement.textContent = message;
                
                // æ ¹æ®ç±»å‹è®¾ç½®é¢œè‰²
                statusElement.style.color = '';
                if (type === 'error') {
                    statusElement.style.color = '#ff6b6b';
                } else if (type === 'warning') {
                    statusElement.style.color = '#d4a24e';
                }
            }
            
            // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
            updateTimerDisplay() {
                const hours = Math.floor(this.elapsedTime / 3600);
                const minutes = Math.floor((this.elapsedTime % 3600) / 60);
                const seconds = this.elapsedTime % 60;
                
                let timeString;
                if (hours > 0) {
                    timeString = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }
                
                document.getElementById('timer').textContent = timeString;
            }
            
            // æ›´æ–°è®¡æ—¶å™¨çŠ¶æ€
            updateTimerState() {
                const icon = document.getElementById('pause-icon');
                const status = document.getElementById('timer-status');
                
                if (this.isTimerPaused) {
                    icon.className = 'fa fa-play';
                    status.textContent = 'å·²æš‚åœ';
                } else {
                    icon.className = 'fa fa-pause';
                    status.textContent = 'è¿›è¡Œä¸­';
                }
            }
            
            // æ›´æ–°è°œé¢˜ä¿¡æ¯
            updatePuzzleInfo() {
                document.getElementById('puzzle-number').textContent = `#${this.puzzleIndex}`;
                document.getElementById('difficulty-display').textContent = 
                    this.difficulty === 'easy' ? 'ç®€å•' : 
                    this.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾';
            }
            
            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            updateStatsDisplay() {
                // è®¡ç®—ç©ºå•å…ƒæ ¼
                let emptyCells = 0;
                for (let row = 0; row < 9; row++) {
                    for (let col = 0; col < 9; col++) {
                        if (this.board[row][col] === 0) emptyCells++;
                    }
                }
                
                document.getElementById('empty-cells').textContent = emptyCells;
                document.getElementById('hints-used').textContent = this.stats.hintsUsed;
                document.getElementById('mistakes-made').textContent = this.stats.mistakesMade;
                document.getElementById('undos-used').textContent = this.stats.undosUsed;
            }
            
            // æ›´æ–°æ‰€æœ‰UI
            updateUI() {
                this.updateBoardDisplay();
                this.updateTimerDisplay();
                this.updateTimerState();
                this.updatePuzzleInfo();
                this.updateStatsDisplay();
                this.updateStatus('é€‰æ‹©å•å…ƒæ ¼å¼€å§‹æ¸¸æˆ');
            }
            
            // æ˜¾ç¤ºè§„åˆ™æ¨¡æ€æ¡†
            showRulesModal() {
                document.getElementById('rules-modal').classList.add('active');
            }
            
            // éšè—è§„åˆ™æ¨¡æ€æ¡†
            hideRulesModal() {
                document.getElementById('rules-modal').classList.remove('active');
            }
            
            // æ˜¾ç¤ºèƒœåˆ©æ¨¡æ€æ¡†
            showWinModal(isNewBest) {
                // æ›´æ–°å†…å®¹
                document.getElementById('completed-puzzle').textContent = this.puzzleIndex;
                document.getElementById('completed-time').textContent = document.getElementById('timer').textContent;
                
                const difficultyText = this.difficulty === 'easy' ? 'ç®€å•' : 
                                     this.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾';
                document.getElementById('win-difficulty').textContent = `å®Œæˆ${difficultyText}éš¾åº¦è°œé¢˜ï¼`;
                
                // æ˜¾ç¤ºæœ€ä½³æˆç»©æ¶ˆæ¯
                const bestMessage = document.getElementById('best-time-message');
                if (isNewBest) {
                    bestMessage.style.display = 'block';
                } else {
                    bestMessage.style.display = 'none';
                }
                
                // æ˜¾ç¤ºæ¨¡æ€æ¡†
                document.getElementById('win-modal').classList.add('active');
            }
            
            // éšè—èƒœåˆ©æ¨¡æ€æ¡†
            hideWinModal() {
                document.getElementById('win-modal').classList.remove('active');
            }
            
            // æ˜¾ç¤ºåŠ è½½
            showLoading() {
                document.getElementById('loading').classList.add('active');
            }
            
            // éšè—åŠ è½½
            hideLoading() {
                document.getElementById('loading').classList.remove('active');
            }
            
            // æ·»åŠ åº†ç¥æ•ˆæœ
            addCelebrationEffect() {
                const cells = document.querySelectorAll('.cell');
                cells.forEach((cell, index) => {
                    setTimeout(() => {
                        cell.classList.add('celebrate');
                        setTimeout(() => cell.classList.remove('celebrate'), 1000);
                    }, index * 30);
                });
            }
            
            // ==============================
            // æ•°æ®æŒä¹…åŒ–
            // ==============================
            
            // ä¿å­˜ç»Ÿè®¡
            saveStats() {
                try {
                    localStorage.setItem('sudoku_stats', JSON.stringify(this.stats));
                } catch (e) {
                    console.error('ä¿å­˜ç»Ÿè®¡å¤±è´¥:', e);
                }
            }
            
            // åŠ è½½ç»Ÿè®¡
            loadStats() {
                try {
                    const saved = localStorage.getItem('sudoku_stats');
                    if (saved) {
                        const stats = JSON.parse(saved);
                        this.stats = { ...this.stats, ...stats };
                    }
                } catch (e) {
                    console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', e);
                }
            }
        }
        
        // ==============================
        // åˆå§‹åŒ–æ¸¸æˆ
        // ==============================
        let game;
        
        document.addEventListener('DOMContentLoaded', () => {
            game = new SudokuGame();
        });
    </script>
</body>
</html>